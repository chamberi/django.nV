#Vulnerability Report
**Reviewer 1:** Colin Lamont

**Reviewer 2:** Claire Gatenby

**Date:** Feb 03, 2017

**Reviewing:** [django.nV](https://github.com/nVisium/django.nV)

##A1 - Injection

###Exposure
We found an instance of injection vulnerability by saving a profile photo as `INSERT INTO taskManager_file ('name','path','project_id') VALUES ('testPic',(SELECT password FROM auth_user WHERE username='admin'),8);--,...` and uploading the file to my profile picture on the edit profile page.

###Repair
The `upload` function within `views.py` contained the vulnerability. We were able to fix the first with the following adjustment(s):

```
file = File(
            name=name,
            path=upload_path,
            project=proj)

            file.save()
```


##A2 - Broken Auth
The registration form could be hacked by using chrome developer tools, and changing the registration form to include superuser checkbox and staff checkbox.
```
<label for="id_is_superuser">Superuser status:</label>
<label for="id_is_staff">Staff status:</label></th><td><input id="id_is_staff" name="is_staff" type="checkbox" />
```

###Exposure
I can now go into the admin panel, and delete users accounts, steal email addresses, etc.

###Repair
In register.html
```
class UserForm(forms.ModelForm):
    """ User registration form """
    class Meta:
        model = User
        exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active', 'id_is_superuser', 'id_is_staff']
```


##A3 - Cross Site Scripting (XSS)

XSS flaws occur whenever an application takes untrusted data and sends it to a web browser without proper validation or escaping. XSS allows attackers to execute scripts in the victimâ€™s browser which can hijack user sessions, deface web sites, or redirect the user to malicious sites.

###Exposure
By changing the username to `<script>alert('boo!');</script>` we were able to inject javascript into the website. On reload of the dashboard, an alert box poped up with the word 'boo!'.

###Repair
The username is rendered from the database to the top corner of the page and has the django `safe` method. This method marks a string as not requiring further HTML escaping prior to output. This occurs in tutorials/base.html and base_backend.html
```
<span class="username">{{ user.username|safe }}</span>
```
Removing the `safe` method allows the username to be escaped and prevents scripts from being run on the website.

##A4 - Insecure Direct Object Reference (DOR)

A direct object reference is likely to occur when a developer exposes a reference to an internal implementation object, such as a file, directory, or database key without any validation mechanism which will allow attackers to manipulate these references to access unauthorized data.

### Exposure
By choosing a route with an id we were able to go to forms and perform POST requests for tasks that weren't our own.

For example the routes
`/taskManager/1/project_delete/`

`/taskManager/1/edit_project/`

`/taskManager/1/upload/`

We were able to delete, edit and upload projects without actually owning the project, just by typing in the URL.

### Repair
Check user is Authenticated for tasks in the `views.py` function, and don't allow unauthenticated users access to the website.

Using django's `user.is_authenticated()` method in the `views.py` can check if the user is logged in. `user.has_permission()` checks if the user belongs to a particular permission group.

The views that have this vulnerability will have to be updated with these methods, an example below is for the `project_delete` view. 

```Python
def project_delete(request, project_id):

    if user.has_permission('delete'):
        project = Project.objects.get(pk=project_id)
        project.delete()
        return redirect('/taskManager/dashboard')
```
